<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMSilks Trading - Simple System</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f9; padding: 20px; color: #333; }
        .container { max-width: 980px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* LOGIN OVERLAY */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0056b3; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; }
        .login-box { background: white; padding: 30px; border-radius: 10px; text-align: center; color: #333; width: 300px; }
        .login-box input { font-size: 24px; text-align: center; letter-spacing: 5px; margin: 20px 0; padding: 10px; width: 80%; border: 2px solid #ddd; border-radius: 5px; }
        .btn-login { background-color: #28a745; color: white; width: 100%; padding: 12px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; }

        /* Header */
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #0056b3; padding-bottom: 15px; }
        header h1 { margin: 0; color: #0056b3; font-size: 32px; text-transform: uppercase; letter-spacing: 1px; }
        header .sub-head { font-size: 14px; color: #555; margin-top: 3px; font-weight: bold; }
        header .web-info { font-size: 13px; color: #0056b3; margin-top: 5px; }
        
        /* Inputs & Layout */
        .input-group { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .input-box { flex: 1; min-width: 150px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .section-box { background: #eef2f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #d1d9e6; }
        .hidden-input { display: none; margin-top: 5px; }

        /* Buttons */
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; color: white; margin-top:5px; transition: 0.3s; font-weight: bold; }
        .btn-add { background-color: #28a745; width: 100%; padding: 12px; font-size: 16px; }
        .btn-inv { background-color: #0056b3; } 
        .btn-quote { background-color: #ffc107; color: #333; }
        .btn-receipt { background-color: #20c997; color: white; }
        .btn-po { background-color: #e67e22; }
        .btn-prod { background-color: #6f42c1; }
        .btn-edit { background-color: #17a2b8; padding: 5px 10px; font-size: 12px; }
        .btn-wa { background-color: #25D366; }
        .btn-print { background-color: #6c757d; }
        .btn-close { background-color: #dc3545; }
        
        .bottom-actions { margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; }
        .btn-save { background-color: #17a2b8; padding: 15px; width: 100%; font-size: 18px; margin-bottom: 10px; }
        .btn-history { background-color: #343a40; width: 100%; padding: 12px; }
        .btn-clear { background-color: #dc3545; width: 100%; padding: 12px; margin-top: 10px; }

        /* Tables & Lists */
        #savedListArea { display: none; background: #fff8e1; padding: 15px; border: 1px solid #ffeeba; margin-bottom: 20px; border-radius: 5px; }
        .saved-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ddd; background: white; margin-bottom: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        th, td { border: 1px solid #dee2e6; padding: 8px; text-align: left; vertical-align: middle; }
        th { background-color: #f1f3f5; font-weight: bold; }
        .text-right { text-align: right; }

        /* Receipt Box Design */
        .receipt-box { display: none; border: 2px solid #333; padding: 20px; margin-top: 20px; background: #fff; }
        .receipt-row { display: flex; margin-bottom: 15px; align-items: baseline; }
        .receipt-label { font-weight: bold; width: 150px; color: #555; }
        .receipt-value { border-bottom: 1px dotted #333; flex: 1; padding-bottom: 5px; font-weight: 500; font-size: 18px; }
        .receipt-amount-box { border: 2px solid #333; padding: 10px 20px; font-size: 24px; font-weight: bold; display: inline-block; margin-top: 20px; background: #f8f9fa; }
        .receipt-footer { display: flex; justify-content: space-between; margin-top: 50px; }
        .receipt-sig { border-top: 1px solid #333; width: 200px; text-align: center; padding-top: 5px; }

        #docView { display: none; }
        .amount-words { margin-top: 15px; font-style: italic; font-weight: bold; border-top: 1px solid #eee; padding-top: 10px; }

        @media print {
            body * { visibility: hidden; }
            #docView, #docView * { visibility: visible; }
            #docView { position: absolute; left: 0; top: 0; width: 100%; display: block; }
            .no-print { display: none !important; }
            input { border: none; background: transparent; }
        }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="margin-bottom: 20px; font-size: 24px; font-weight: bold; color:white;">AMSilks Trading</div>
    <div class="login-box">
        <h3>Login</h3>
        <input type="password" id="loginPin" placeholder="PIN" maxlength="4">
        <button class="btn-login" onclick="checkLogin()">Unlock</button>
    </div>
</div>

<div class="container" id="editorSection">
    <header>
        <h1>AMSilks Trading W.L.L.</h1>
        <div class="sub-head">Doha - Qatar | CR No: 224866</div>
        <div class="web-info">www.amsilks.com | info@amsilks.com</div>
    </header>

    <div id="savedListArea">
        <h3>Saved History</h3>
        <div id="savedItemsContainer"></div>
        <button class="btn btn-close" onclick="toggleSavedList()">Close List</button>
    </div>

    <div class="input-group">
        <div class="input-box"><label>Customer Name</label><input type="text" id="custName"></div>
        <div class="input-box"><label>Customer Phone</label><input type="tel" id="custPhone"></div>
        <div class="input-box"><label>Supplier Name (For PO)</label><input type="text" id="suppName"></div>
        <div class="input-box" style="background: #fff3cd; border-radius: 5px; padding: 5px;">
            <label>Previous Balance</label>
            <input type="number" id="prevBalanceInput" value="0" style="font-weight:bold; color:#856404;" oninput="calculateGrandTotal()">
        </div>
    </div>

    <div class="section-box">
        <div class="section-title">Add Items / Measurements</div>
        
        <div class="input-group">
            <div class="input-box"><label>Building Type</label><select id="buildingType" onchange="updateRoomOptions()"><option value="House">House / Villa</option><option value="Tower">Tower / Building</option><option value="Other">Other</option></select><input type="text" id="towerNameInput" class="hidden-input" placeholder="Enter Tower Name"></div>
            <div class="input-box"><label>Floor</label><select id="floorSelect" onchange="checkManualInput('floorSelect', 'manualFloor')"><option value="Ground Floor">Ground Floor</option><option value="First Floor">First Floor</option><option value="Other">Other</option></select><input type="text" id="manualFloor" class="hidden-input" placeholder="Type Floor"></div>
            <div class="input-box"><label>Room Name</label><select id="roomSelect" onchange="checkManualInput('roomSelect', 'manualRoom')"></select><input type="text" id="manualRoom" class="hidden-input" placeholder="Type Room Name"></div>
        </div>

        <div class="input-group">
            <div class="input-box"><label>Type</label><select id="type" onchange="toggleFields()"><option value="Heavy Curtain">Heavy Curtain</option><option value="Sheer Curtain">Sheer Curtain</option><option value="Roller Blind">Roller Blind</option><option value="Roman Blind">Roman Blind</option><option value="Other">Other</option></select></div>
            <div class="input-box" id="fullnessBox"><label>Fullness</label><select id="fullnessSelect" onchange="checkCustomFullness()"><option value="3">Normal (1 x 3)</option><option value="2">Project (1 x 2)</option><option value="custom">Custom</option></select><input type="number" id="customFullnessInput" class="hidden-input" placeholder="Enter Ratio"></div>
            <div class="input-box" id="fabricWidthBox"><label>Fabric Width</label><select id="fabricWidthSelect"><option value="1.4">Standard (1.4)</option><option value="2.8">Wide (2.8)</option><option value="3.0">Wide (3.0)</option></select></div>
            <div class="input-box"><label>Fabric No</label><input type="text" id="fabricNo"></div>
        </div>

        <div class="input-group">
            <div class="input-box" style="max-width: 100px;"><label>Qty</label><input type="number" id="itemQty" value="1"></div>
            <div class="input-box"><label>W (cm)</label><input type="number" id="width"></div>
            <div class="input-box"><label>H (cm)</label><input type="number" id="height"></div>
            <div class="input-box"><label>Price</label><input type="number" id="price"></div>
            <div class="input-box" id="stitchingBox"><label>Stitch Rate</label><input type="number" id="stitchCharge" value="0"></div>
            <div class="input-box"><label>Fixing Rate</label><input type="number" id="fixCharge" value="0"></div>
        </div>

        <button class="btn btn-add" onclick="addItem()">+ Add to List</button>
    </div>

    <h3>Item List</h3>
    <table id="draftTable">
        <thead><tr><th>Details</th><th>Size</th><th>Total</th><th>Action</th></tr></thead>
        <tbody></tbody>
    </table>

    <div style="display:flex; gap:10px; margin-top:20px; background: #eee; padding:10px; border-radius:5px;">
        <div class="input-box"><label>Discount</label><input type="number" id="discountInput" value="0" oninput="calculateGrandTotal()"></div>
        <div class="input-box"><label>Advance / Receipt Amount</label><input type="number" id="advanceInput" value="0" style="font-weight:bold; color:green;" oninput="calculateGrandTotal()"></div>
    </div>

    <br>
    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
        <button class="btn btn-inv" onclick="generateDocument('invoice')">Invoice</button>
        <button class="btn btn-quote" onclick="generateDocument('quotation')">Quotation</button>
        <button class="btn btn-receipt" onclick="generateDocument('receipt')">Receipt Voucher</button>
        <button class="btn btn-po" onclick="generateDocument('po')">Purchase Order</button>
        <button class="btn btn-prod" onclick="generateDocument('production')">Production</button>
    </div>

    <div class="bottom-actions">
        <button class="btn btn-save" onclick="saveCurrentOrder()">üíæ Save to Google Sheet</button>
        <button class="btn btn-history" onclick="toggleSavedList()">üìÇ Open History</button>
        <button class="btn btn-clear" onclick="clearData()">‚ùå Clear All</button>
    </div>
</div>

<div class="container" id="docView">
    <header>
        <h1>AMSilks Trading W.L.L.</h1>
        <div class="sub-head">Doha - Qatar | CR No: 224866</div>
        <div class="sub-head">Contact: 77070221</div>
        <h2 id="docTitle" style="margin-top:10px; color:#555;">INVOICE</h2>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
            <div><strong>To:</strong> <span id="docToName"></span><br><span id="docToPhone"></span></div>
            <div style="text-align: right;"><strong>Date:</strong> <span id="docDate"></span><br><strong>Ref:</strong> <span id="docRef"></span></div>
        </div>
    </header>

    <table id="docTable">
        <thead><tr id="tableHeaderRow"></tr></thead>
        <tbody id="docBody"></tbody>
        <tfoot class="price-col">
            <tr><td id="colspanGap" class="text-right"><strong>Total:</strong></td><td id="subTotal">0.00</td></tr>
            <tr id="trDiscount"><td id="colspanGapDisc" class="text-right"><strong>Discount:</strong></td><td id="dispDiscount">0.00</td></tr>
            <tr id="trPrevBal" style="background-color: #fff3cd;"><td id="colspanGapPrev" class="text-right"><strong>Old Due:</strong></td><td id="displayPrevBal">0.00</td></tr>
            <tr><td id="colspanGapGrand" class="text-right" style="font-size:16px;"><strong>GRAND TOTAL:</strong></td><td id="grandTotal" style="font-size:16px; font-weight:bold;">0.00</td></tr>
            <tr id="trAdvance"><td id="colspanGapAdv" class="text-right"><strong>Paid:</strong></td><td id="dispAdvance">0.00</td></tr>
            <tr id="trBalanceDue"><td id="colspanGapBal" class="text-right" style="color: #dc3545;"><strong>BALANCE:</strong></td><td id="balanceDue" style="font-weight:bold; color: #dc3545; font-size:15px;">0.00</td></tr>
        </tfoot>
    </table>

    <div id="receiptBox" class="receipt-box">
        <div class="receipt-row"><div class="receipt-label">Received from:</div><div class="receipt-value" id="rcptName"></div></div>
        <div class="receipt-row"><div class="receipt-label">The sum of:</div><div class="receipt-value" id="rcptWords"></div></div>
        <div class="receipt-row"><div class="receipt-label">Being:</div><div class="receipt-value">Advance / Payment for Curtain Works</div></div>
        <div style="display:flex; justify-content: space-between; align-items: flex-end;">
            <div class="receipt-amount-box">QR <span id="rcptAmount">0.00</span></div>
            <div style="font-size:12px;">Mode: Cash &nbsp;‚òê&nbsp;&nbsp; Card &nbsp;‚òê&nbsp;&nbsp; Cheque &nbsp;‚òê</div>
        </div>
        <div class="receipt-footer"><div class="receipt-sig">Accountant</div><div class="receipt-sig">Receiver's Signature</div></div>
    </div>

    <div id="amountWords" class="amount-words no-print-placeholder"></div>

    <div class="no-print" style="margin-top: 30px; text-align: center; display: flex; gap: 10px; justify-content: center;">
        <button class="btn btn-save" onclick="saveCurrentOrder()" style="width:auto;">üíæ Save</button>
        <button class="btn btn-print" onclick="window.print()">Print / PDF</button>
        <button class="btn btn-wa" onclick="sendWhatsapp()">WhatsApp</button>
        <button class="btn btn-close" onclick="closeDoc()">Back</button>
    </div>
</div>

<script>
    // GOOGLE SHEET URL - UPDATE THIS IF NEEDED
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbwTRm-mr-jkWPwf34CypR0ppqBqMT-YuF1kqRTw7Qes88f8On4A29e2htFpCGl_yoRJ_A/exec";

    let cart = []; let currentMode = 'invoice'; let globalSubTotal = 0; let currentUserRole = 'sales';
    const curtainTypes = ["Heavy Curtain", "Sheer Curtain", "Blackout Curtain"];

    window.onload = function() { updateRoomOptions(); };

    function checkLogin() {
        let pin = document.getElementById("loginPin").value;
        if(pin === "9999") { currentUserRole = 'admin'; document.getElementById("loginOverlay").style.display = "none"; }
        else if(pin === "1111") { currentUserRole = 'sales'; document.getElementById("loginOverlay").style.display = "none"; }
        else { alert("Wrong PIN"); }
    }

    function logout() { location.reload(); }

    function saveCurrentOrder() {
        let name = document.getElementById("custName").value || "Unnamed";
        // If Receipt Mode, allow saving without items (just amount)
        if (currentMode !== 'receipt' && cart.length === 0) { alert("Cart is empty!"); return; }
        
        let grandTotal = document.getElementById("grandTotal").innerText;
        let advance = document.getElementById("advanceInput").value || 0;
        let supp = document.getElementById("suppName").value;

        // If Receipt mode, the 'Grand Total' field isn't relevant, we use the Advance Input as the Amount
        if(currentMode === 'receipt') {
            grandTotal = advance; // The receipt amount
        }

        let orderData = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            custName: name,
            custPhone: document.getElementById("custPhone").value,
            suppName: supp,
            recordType: currentMode, // Saves as 'invoice', 'po', 'receipt' etc.
            grandTotal: grandTotal,
            advance: advance,
            cart: cart
        };

        // Save Locally
        let savedOrders = JSON.parse(localStorage.getItem("amsilksSavedOrders") || "[]");
        savedOrders.push(orderData);
        localStorage.setItem("amsilksSavedOrders", JSON.stringify(savedOrders));

        // Save to Cloud
        let btn = document.querySelectorAll(".btn-save");
        btn.forEach(b => { b.innerText = "Saving..."; b.disabled = true; });

        fetch(SHEET_API_URL, {
            method: "POST", mode: "no-cors", headers: { "Content-Type": "text/plain" },
            body: JSON.stringify(orderData)
        }).then(() => {
            alert("Saved Successfully!");
            btn.forEach(b => { b.innerText = "üíæ Save to Google Sheet"; b.disabled = false; });
        }).catch(err => {
            alert("Saved Locally Only (Check Net).");
            btn.forEach(b => { b.innerText = "üíæ Save to Google Sheet"; b.disabled = false; });
        });
    }

    function generateDocument(mode) {
        currentMode = mode;
        document.getElementById("editorSection").style.display = "none";
        document.getElementById("docView").style.display = "block";
        document.getElementById("docDate").innerText = new Date().toLocaleDateString();
        document.getElementById("docRef").innerText = "AMS-" + Math.floor(Math.random() * 1000);
        
        let table = document.getElementById("docTable");
        let receiptBox = document.getElementById("receiptBox");
        let tfoot = document.querySelector("tfoot");
        let title = document.getElementById("docTitle");
        let nameEl = document.getElementById("docToName");

        table.style.display = "table"; 
        receiptBox.style.display = "none";
        tfoot.style.display = "table-footer-group";
        document.getElementById("amountWords").style.display = "block";

        if(mode === 'invoice') {
            title.innerText = "INVOICE";
            nameEl.innerText = document.getElementById("custName").value;
        } else if(mode === 'quotation') {
            title.innerText = "QUOTATION";
            nameEl.innerText = document.getElementById("custName").value;
        } else if(mode === 'po') {
            title.innerText = "PURCHASE ORDER";
            nameEl.innerText = document.getElementById("suppName").value;
            tfoot.style.display = "none";
        } else if(mode === 'production') {
            title.innerText = "PRODUCTION SHEET";
            nameEl.innerText = "Internal Workshop";
            tfoot.style.display = "none";
        } else if(mode === 'receipt') {
            title.innerText = "RECEIPT VOUCHER";
            table.style.display = "none";
            tfoot.style.display = "none";
            document.getElementById("amountWords").style.display = "none";
            receiptBox.style.display = "block";
            
            let amt = parseFloat(document.getElementById("advanceInput").value) || 0;
            document.getElementById("rcptName").innerText = document.getElementById("custName").value;
            document.getElementById("rcptAmount").innerText = amt.toFixed(2);
            document.getElementById("rcptWords").innerText = numberToWords(amt);
        }

        if(mode !== 'receipt') {
            let tbody = document.getElementById("docBody");
            let header = document.getElementById("tableHeaderRow");
            tbody.innerHTML = "";
            header.innerHTML = `<th>#</th><th>Description</th><th>Size</th><th>Qty</th>${(mode==='invoice'||mode==='quotation') ? '<th>Price</th><th>Total</th>' : ''}`;
            
            let span = (mode==='invoice'||mode==='quotation') ? 6 : 4;
            document.getElementById("colspanGap").colSpan = span;
            document.getElementById("colspanGapDisc").colSpan = span;
            document.getElementById("colspanGapPrev").colSpan = span;
            document.getElementById("colspanGapGrand").colSpan = span;
            document.getElementById("colspanGapAdv").colSpan = span;
            document.getElementById("colspanGapBal").colSpan = span;

            globalSubTotal = 0;
            cart.forEach((item, i) => {
                globalSubTotal += item.totalCost;
                let desc = `${item.room} - ${item.type} (Fab: ${item.fabricNo})`;
                let row = `<tr><td>${i+1}</td><td>${desc}</td><td>${item.w}x${item.h}</td><td>${item.itemQty}</td>`;
                if(mode==='invoice'||mode==='quotation') row += `<td>${item.price}</td><td>${item.totalCost}</td>`;
                tbody.innerHTML += row + "</tr>";
            });
            document.getElementById("subTotal").innerText = globalSubTotal.toFixed(2);
            calculateGrandTotal();
        }
    }

    // --- STANDARD FUNCTIONS (Simplified) ---
    function addItem() {
        let room = document.getElementById("manualRoom").value || document.getElementById("roomSelect").value;
        let type = document.getElementById("type").value;
        let fab = document.getElementById("fabricNo").value;
        let w = parseFloat(document.getElementById("width").value) || 0;
        let h = parseFloat(document.getElementById("height").value) || 0;
        let qty = parseInt(document.getElementById("itemQty").value) || 1;
        let price = parseFloat(document.getElementById("price").value) || 0;
        let stitch = parseFloat(document.getElementById("stitchCharge").value) || 0;
        let fix = parseFloat(document.getElementById("fixCharge").value) || 0;
        
        // Simple Calc: (Area * Price) + Stitch + Fix. (Adjust area logic as per your need)
        let area = w * h; // Assuming input is meters. If CM, divide by 10000. 
        // Based on prev code it was CM input converted to M in logic. Let's assume input is CM:
        area = (w/100) * (h/100); 
        if(type.includes("Curtain")) area = (w/100) * 2; // Dummy logic for simplicity, adjust as needed
        
        let materialCost = area * price * qty;
        let total = materialCost + (stitch * qty) + (fix * qty);
        
        cart.push({room, type, fabricNo: fab, w: w, h: h, itemQty: qty, price, totalCost: total});
        renderDraft();
    }

    function renderDraft() {
        let tb = document.querySelector("#draftTable tbody"); tb.innerHTML = "";
        cart.forEach((i, idx) => {
            tb.innerHTML += `<tr><td>${i.type} (${i.fabricNo})</td><td>${i.w}x${i.h}</td><td>${i.totalCost.toFixed(2)}</td><td><button class="btn-close" style="padding:2px 5px;" onclick="deleteItem(${idx})">X</button></td></tr>`;
        });
    }
    function deleteItem(i) { cart.splice(i, 1); renderDraft(); }
    
    function calculateGrandTotal() {
        let disc = parseFloat(document.getElementById("discountInput").value) || 0;
        let adv = parseFloat(document.getElementById("advanceInput").value) || 0;
        let prev = parseFloat(document.getElementById("prevBalanceInput").value) || 0;
        
        let grand = (globalSubTotal - disc) + prev;
        let bal = grand - adv;
        
        document.getElementById("grandTotal").innerText = grand.toFixed(2);
        document.getElementById("balanceDue").innerText = bal.toFixed(2);
        document.getElementById("dispDiscount").innerText = disc.toFixed(2);
        document.getElementById("dispAdvance").innerText = adv.toFixed(2);
        document.getElementById("displayPrevBal").innerText = prev.toFixed(2);
        document.getElementById("amountWords").innerText = numberToWords(bal);
    }

    function closeDoc() {
        document.getElementById("docView").style.display = "none";
        document.getElementById("editorSection").style.display = "block";
    }

    function toggleSavedList() {
        let area = document.getElementById("savedListArea");
        area.style.display = (area.style.display === "block") ? "none" : "block";
        if(area.style.display === "block") {
            let c = document.getElementById("savedItemsContainer");
            let orders = JSON.parse(localStorage.getItem("amsilksSavedOrders") || "[]");
            c.innerHTML = "";
            orders.reverse().forEach(o => {
                c.innerHTML += `<div class="saved-item"><div><strong>${o.custName||o.suppName}</strong> (${o.recordType})<br>${o.date}</div><div><button class="btn-add" onclick="loadOrder(${o.id})">Load</button></div></div>`;
            });
        }
    }

    function loadOrder(id) {
        if(!confirm("Load?")) return;
        let orders = JSON.parse(localStorage.getItem("amsilksSavedOrders") || "[]");
        let o = orders.find(x => x.id === id);
        if(o) {
            cart = o.cart || [];
            document.getElementById("custName").value = o.custName;
            document.getElementById("custPhone").value = o.custPhone;
            document.getElementById("advanceInput").value = o.advance;
            renderDraft();
            document.getElementById("savedListArea").style.display = "none";
        }
    }

    function clearData() {
        if(confirm("Clear?")) {
            cart = []; document.querySelectorAll("input").forEach(i => i.value="");
            renderDraft();
        }
    }

    function numberToWords(n) { if(n<=0) return "Zero"; return n + " Only"; } // Short for brevity
    
    // UI Helpers
    function updateRoomOptions() { /* Keep simple logic */ }
    function checkManualInput(sel, inp) { document.getElementById(inp).style.display = document.getElementById(sel).value==='Other'?'block':'none'; }
    function checkCustomFullness() { document.getElementById("customFullnessInput").style.display = document.getElementById("fullnessSelect").value==='custom'?'block':'none'; }
    function toggleFields() { /* Keep simple logic */ }
    function sendWhatsapp() { 
        let ph = document.getElementById("custPhone").value;
        let text = `*${currentMode.toUpperCase()}* for ${document.getElementById("docToName").innerText}. Total: ${document.getElementById("grandTotal").innerText}`;
        window.open(`https://wa.me/${ph}?text=${text}`, '_blank');
    }
</script>

</body>
</html>
